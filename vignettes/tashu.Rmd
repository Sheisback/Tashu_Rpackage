---
title: "tashu : Analysis and Demand forecast for Public bicycles('Tashu') in Daejeon, South Korea"
author: "JiWon Min"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
## 1. Introduction
 세계 주요 도시는 녹색대중교통수단으로 공공 자전거 시스템을 운영하며 이는 대중교통 수요 분산, 시민들의 운동량 증대의 효과를 내고 있다.
 
 Major cities in the world operate public bicycle systems as green public transportation. Public bicycle system is leading to the effect of the dispersion of public transportation demand and the increase of the citizens' momentum.

 하지만, 공공 자전거 시스템에선 정류소에 대여할 자전거가 부족하거나 반납할 자리가 없는 불균형 상황이 생길 수 있다. 이런 상황을 사전에 방지하기 위해 자전거 재배치 작업을 행하는 방법이 있다. 공공 자전거 시스템이 커질 수록 재배치 작업의 로드 또한 커지기 때문에, 작업의 효율성을 높이기 위한 방안이 연구될 필요가 있다.
 
 However, in a public bicycle system, there may be an imbalance in which there is not enough the bicycle to be rented at the station or there is no place to return it. In order to prevent such a situation in advance, there is a method of carrying out a bicycle relocation work. As the public bicycle system grows, the load of relocation work also increases, so a way to increase the efficiency of the work needs to be studied.
 
 우선, 자전거 대여 이력 분석을 통해 시민들의 자전거 사용 패턴을 파악해야 한다. 그로 인해, 각 정류소의 수요를 대략적으로 어림잡을 수 있다. 자전거 대여량에 영향을 주는 요인들을 파악하여 그에 따른 자전거 대여량 변화를 확인한다.
 
 First, we need to analyze bicycle usage patterns through citizen's bicycle rental history analysis. Therefore, it is possible to roughly estimate the demand of bike rental each stopping point. Identifying the factors that affect the amount of bicycle rental, We should check the change of bicycle rental amount accordingly.

 두 번째로, 자전거 사용량을 예측하여 각 정류소의 재배치 작업 시간을 결정하는 방법이 있다. 이 패키지는 랜덤 포레스트를 활용한 자전거 사용량 예측 함수를 제공한다. 계절, 월, 시간, 요일, 기온, 습도, 강수량, 축제 영향 여부를 feature로 지정하여 그에 따른 자전거 사용량을 예측하였다.

 Second, there is a method of predicting the amount of bicycle usage and determining the relocation work time of each stopping point. This package provides a bicycle usage prediction function using Random Forest. We selected the season, month, hour, day of week, temperature, humidity, rainfall, and festival effect as feature and predicted demand of bike rental accordingly.

## 2. Data
1.    Tashu Data
: Bicycle rental history on Tashu from 2013 to 2015. Data is consisted of "RENT STATION, RENT DATE, RETURN STATION, RETURN DATE"
* tashu2013 : Rental history In 2013.
* tashu2014 : Rental history In 2014.
* tashu2015 : Rental history In 2015.
* tashuDataFor3year : Rental history from 2013 to 2015.

```{r}
load(file = "../data/tashu2013.rda")
head(tashu2013, n = 5)
```

2.    Tashu Station Data
: By 2014 there were 144 bicycle stations and a new one in 2015, currently operating 244 stations. In this study, only the existing data of 144 stop stations are considered. Data is consisted of "NUM(Number of station), KIOSKNUM(Number of Kiosk), DISTRICT(District where Station is located), Name(Name of station), LOCATION(Location of station), NUMOFBIKE_RACK(Number of Bike rack), GEODATA_lat(Latitude of station), GEODATA_lon(Longitude of station)"

* tashuStationData : data of 144 Stations on Tashu system. 
```{r}
load(file = "../data/tashuStationData.rda")
head(tashuStationData, n = 5)
```

3.    Weather Data
: Weather Data In Daejeon from 2013 to 2015. Data is consisted of "datetime, temperature, rainfall, windspeed, wind direction, humidity, Dew point temperature, Local Pressure, Sea surface Pressure, Sunshine, Solar Radiation, Snowfall, Ground Temperature"

* weather2013 : Weather Data In Daejeon, 2013
* weather2014 : Weather Data In Daejeon, 2014
* weather2015 : Weather Data In Daejeon, 2015

```{r}
load(file = "../data/weather2013.rda")
head(weather2013, n = 5)
```

4.    Festival Data
: Festival Data In Daejeon from 2013 to 2015. Data is consisted of "Festival(Name of festival), Location(Location of festival), nearStation(bike station affected by festival), startDate(festival starting date time), endDate(festival ending date time)"
```{r}
load(file = "../data/festivalData.rda")
head(festivalData, n = 5)
```


## 3. Analysis

대전 시민들의 자전거 사용 패턴을 확인하기 위한 분석을 수행하였다. 자전거 사용량에 영향을 주는 요인으로 시간, 기상 상태를 선정하였다. 그에 따른 자전거 사용량 변화를 확인하였다.
This package provide some functions that analyze bike usage pattern. Time and weather conditions were selected as factors affecting bicycle usage.

1.    getTop10Stations()
: This function presents top 10 stations that have most number of bike rental for 3 years.

```{r}
#library(Tashu)
#getTop10Stations()
```

2.    getTop10Pathes()
: This function presents top 10 pathes that have mostly used for 3 years.
```{r}
#library(Tashu)
#getTop10Pathes()
```

3.    getAmountOfRentalEachMonth()
: This function show average amount of bike rental in each months.
```{r}
#library(Tashu)
#getAmountOfRentalEachMonth()
```

4.    getAmountOfRentalEachDayOfWeek()
: This function show bike usage pattern in each day of week.
```{r}
#library(Tashu)
#getAmountOfRentalEachMonth()
```

5.    getUsageByTemperature()
: This function show the change of bike usage pattern according to Temperature.
```{r}
#library(Tashu)
#getAmountOfRentalEachMonth()
```


## 4. Prediction
 이 패키지는 랜덤 포레스트를 이용한 자전거 사용량 예측을 예제로 제공한다. 사용자들은 n번 정류소의 자전거 대여량을 예측하기 위해서, "학습 데이터 생성 → 예측 모델 수립 → 테스트 데이터 대입 → 예측 결과 확인" 의 과정을 거쳐야 한다.
 
 This package provides function that predict the demand of bike rental using Random Forest as example. Users must go through the process of "generating learning data → establishing a prediction model → assigning test data → confirming forecast results" in order to predict the amount of bicycle rental at the nth stop.

1.    createTrainData(stationNum)
: 이 함수는 랜덤 포레스트 예측 모델을 구현하는데 사용될 학습 데이터를 생성한다. 이 함수는 2013 ~ 2014 년도에 stationNum 정류소에서 일어난 자전거 대여 이력과 날씨, 축제 데이터를 전처리하여 다음과 같은 데이터 프레임을 만들어 반환한다.

 This function generates training data to be used to implement the random forest prediction model. This function prepares the bicycle rental history, weather, and festival data that occurred at stationNum stop in 2013 ~ 2014, and returns the following data frame. 
```{r}
#library(Tashu)
#trainData <- createTrainData(1)
#head(trainData, n = 5)
```

2.    createTestData(stationNum)
: 이 함수는 예측 모델이 예측을 하기 위한 feature 데이터를 제공하는 테스트 데이터를 생성한다. 2015년도에 stationNum 정류소에서 일어난 자전거 대여 이력과 날씨, 축제 데이터를 전처리하여 다음과 같은 데이터 프레임을 만들어 반환한다.

 This function generates testing data that provides feature data for the prediction model. Bike rental history at the stationNum th station, weather and festival data in 2015 are preprocessed and the following data frame is created and returned.
 
```{r}
#library(Tashu)
#testData <- createTestData(1)
#head(testData, n = 5)
```

3.    predictDemandOfBikesUsingRF(trainData, testData, isImportance, numOfTree, type)
: 이 함수는 trainData와 testData를 파라미터로 받아 stationNum 정류소에서의 자전거 사용량 예측을 수행한다. trainData로 랜덤 포레스트 예측 모델을 구현한다. 그 후 테스트 데이터를 예측 모델에 입력하여 자전거 사용량을 예측한다. isImportance를 TRUE로 설정할 시, stationNum 정류소에서의 feature importance를 구할 수 있다.

 This function takes the parameter trainData and testData as parameters and performs the bicycle usage prediction at stationNum stop. First, It implements the random forest prediction model with trainData and input testData to predict the demand of bike rental. If you set isImportance to TRUE, you can get the feature importance at the stationNum stop.
 
```{r}
#library(Tashu)
#trainData <- createTrainData(1)
#testData <- createTestData(1)
#
#resultData <- predictDemandOfBikesUsingRF(trainData, testData, isImportance = TRUE, numOfTree = 50, type = 1)
#head(resultData, n = 5)
```
